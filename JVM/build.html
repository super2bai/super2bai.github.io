<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <link rel="stylesheet" href="/style/style.css">
<script>
  var nlviconfig = {
    title: "贰白",
    author: "super2bai",
    baseUrl: "/",
    theme: {
      scheme: "banderole",
      lightbox: true,
      animate: true,
      search: true,
      friends: false,
      reward: true,
      lazy: false
    }
  }
</script>




    <link rel="stylesheet" href="/script/lib/lightbox/css/lightbox.min.css">




    <link rel="stylesheet" href="/syuanpi/syuanpi.min.css">




    <link rel="icon" href="https://wx4.sinaimg.cn/mw690/8c564d2agy1fq4rsiycy4j202c01wa9v.jpg">




<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-98059014-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116557847-1');
</script>





    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="browsermode" content="application">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="贰白">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="msapplication-navbutton-color" content="#666666">
<meta name= "format-detection" content="telephone=no" />
<meta name="keywords" content="nlvi, Nlvi" />

  <link rel="apple-touch-icon"  sizes="72x72"  href="https://wx4.sinaimg.cn/mw690/8c564d2agy1fq4rsiycy4j202c01wa9v.jpg">
  <link rel="apple-touch-icon-precomposed"  sizes="72x72"  href="https://wx4.sinaimg.cn/mw690/8c564d2agy1fq4rsiycy4j202c01wa9v.jpg">


  <meta name="subtitle" content="苦于探索，全是未知">


  <meta name="description" content="苦于探索，全是未知">



  <meta name="keywords" content="JVM, Nlvi" />

  <title> Mac 编译openJDK9 · 贰白 </title>
</head>
<body>
  <div class="progress">
  <div class="progress-inner"></div>
</div>
  
  
    <div class="tagcloud-mask"></div>  
<div class="tagcloud" id="tagcloud">
  <div class="tagcloud-inner">
    <a href="/tags/Data-Structures/" style="font-size: 14px;">Data Structures</a> <a href="/tags/Docker/" style="font-size: 14px;">Docker</a> <a href="/tags/Dubbo/" style="font-size: 14px;">Dubbo</a> <a href="/tags/GHPages/" style="font-size: 14px;">GHPages</a> <a href="/tags/IO/" style="font-size: 14px;">IO</a> <a href="/tags/JDK/" style="font-size: 14px;">JDK</a> <a href="/tags/JVM/" style="font-size: 14px;">JVM</a> <a href="/tags/Linux/" style="font-size: 14px;">Linux</a> <a href="/tags/MyBatis/" style="font-size: 14px;">MyBatis</a> <a href="/tags/MySQL/" style="font-size: 14px;">MySQL</a> <a href="/tags/Python/" style="font-size: 14px;">Python</a> <a href="/tags/Spring/" style="font-size: 14px;">Spring</a> <a href="/tags/Zookeeper/" style="font-size: 14px;">Zookeeper</a> <a href="/tags/book/" style="font-size: 14px;">book</a> <a href="/tags/code/" style="font-size: 14px;">code</a> <a href="/tags/emacs/" style="font-size: 14px;">emacs</a> <a href="/tags/es/" style="font-size: 14px;">es</a> <a href="/tags/git/" style="font-size: 14px;">git</a> <a href="/tags/github/" style="font-size: 14px;">github</a> <a href="/tags/idea/" style="font-size: 14px;">idea</a> <a href="/tags/jmeter/" style="font-size: 14px;">jmeter</a> <a href="/tags/mac/" style="font-size: 14px;">mac</a> <a href="/tags/monitor/" style="font-size: 14px;">monitor</a> <a href="/tags/server/" style="font-size: 14px;">server</a> <a href="/tags/walkup/" style="font-size: 14px;">walkup</a> <a href="/tags/分布式/" style="font-size: 14px;">分布式</a> <a href="/tags/工具/" style="font-size: 14px;">工具</a> <a href="/tags/并发/" style="font-size: 14px;">并发</a> <a href="/tags/旅游/" style="font-size: 14px;">旅游</a> <a href="/tags/汇编/" style="font-size: 14px;">汇编</a> <a href="/tags/监控/" style="font-size: 14px;">监控</a> <a href="/tags/编码/" style="font-size: 14px;">编码</a>
  </div>
</div>  
  

  <div class="container">

    <header class="header" id="header">
  <div class="header-wrapper">
    <div class="logo">
  <div class="logo-inner syuanpi tvIn">
    <span><a href="/">贰白</a></span>
    
      <span id="subtitle">苦于探索，全是未知</span>
    
  </div>
</div>
    <nav class="main-nav">
  
  <ul class="main-nav-list syuanpi tvIn">
  
    <li class="menu-item">
      <a href="javascript:;" id="search">
        <span>搜索</span>
        
          <span class="menu-item-label">search</span>
        
      </a>
    </li>
  
  
    
      
    
    <li class="menu-item">
      <a href="/" id="article">
        <span class="base-name">文章</span>
        
          <span class="menu-item-label">article</span>
        
      </a>
    </li>
  
    
      
    
    <li class="menu-item">
      <a href="/archives" id="archives">
        <span class="base-name">归档</span>
        
          <span class="menu-item-label">archives</span>
        
      </a>
    </li>
  
    
      
    
    <li class="menu-item">
      <a href="javascript:;" id="tags">
        <span class="base-name">标签</span>
        
          <span class="menu-item-label">tags</span>
        
      </a>
    </li>
  
    
      
    
    <li class="menu-item">
      <a href="/about" id="about">
        <span class="base-name">关于</span>
        
          <span class="menu-item-label">about</span>
        
      </a>
    </li>
  
  </ul>
  
</nav>

    
    
  </div>
</header>
<div class="mobile-header">
  <div class="mobile-header-body">
    <div class="mobile-header-list">
      
        
            <div class="mobile-nav-item">
                <a href="/">
                    <span>文章</span>
                    
                        <span class="menu-item-label">article</span>
                    
                </a>
            </div>
        
      
        
            <div class="mobile-nav-item">
                <a href="/archives">
                    <span>归档</span>
                    
                        <span class="menu-item-label">archives</span>
                    
                </a>
            </div>
        
      
        
          <div class="mobile-nav-item inner-cloud">
            <div class="mobile-nav-tag">
              <a href="javascript:;" id="mobile-tags">
                <span>标签</span>
                
                    <span class="menu-item-label">tags</span>
                
              </a>
            </div>
            <div class="mobile-nav-tagcloud">
              <div class="mobile-tagcloud-inner">
                <a href="/tags/Data-Structures/" style="font-size: 14px;">Data Structures</a> <a href="/tags/Docker/" style="font-size: 14px;">Docker</a> <a href="/tags/Dubbo/" style="font-size: 14px;">Dubbo</a> <a href="/tags/GHPages/" style="font-size: 14px;">GHPages</a> <a href="/tags/IO/" style="font-size: 14px;">IO</a> <a href="/tags/JDK/" style="font-size: 14px;">JDK</a> <a href="/tags/JVM/" style="font-size: 14px;">JVM</a> <a href="/tags/Linux/" style="font-size: 14px;">Linux</a> <a href="/tags/MyBatis/" style="font-size: 14px;">MyBatis</a> <a href="/tags/MySQL/" style="font-size: 14px;">MySQL</a> <a href="/tags/Python/" style="font-size: 14px;">Python</a> <a href="/tags/Spring/" style="font-size: 14px;">Spring</a> <a href="/tags/Zookeeper/" style="font-size: 14px;">Zookeeper</a> <a href="/tags/book/" style="font-size: 14px;">book</a> <a href="/tags/code/" style="font-size: 14px;">code</a> <a href="/tags/emacs/" style="font-size: 14px;">emacs</a> <a href="/tags/es/" style="font-size: 14px;">es</a> <a href="/tags/git/" style="font-size: 14px;">git</a> <a href="/tags/github/" style="font-size: 14px;">github</a> <a href="/tags/idea/" style="font-size: 14px;">idea</a> <a href="/tags/jmeter/" style="font-size: 14px;">jmeter</a> <a href="/tags/mac/" style="font-size: 14px;">mac</a> <a href="/tags/monitor/" style="font-size: 14px;">monitor</a> <a href="/tags/server/" style="font-size: 14px;">server</a> <a href="/tags/walkup/" style="font-size: 14px;">walkup</a> <a href="/tags/分布式/" style="font-size: 14px;">分布式</a> <a href="/tags/工具/" style="font-size: 14px;">工具</a> <a href="/tags/并发/" style="font-size: 14px;">并发</a> <a href="/tags/旅游/" style="font-size: 14px;">旅游</a> <a href="/tags/汇编/" style="font-size: 14px;">汇编</a> <a href="/tags/监控/" style="font-size: 14px;">监控</a> <a href="/tags/编码/" style="font-size: 14px;">编码</a>
              </div>
            </div>
          </div>
        
      
        
            <div class="mobile-nav-item">
                <a href="/about">
                    <span>关于</span>
                    
                        <span class="menu-item-label">about</span>
                    
                </a>
            </div>
        
      
    </div>
  </div>
  <div class="mobile-header-nav">
    <div class="mobile-header-item" id="mobile-left">
      <div class="header-menu-item">
        <span class="header-menu-line"></span>
      </div>
    </div>
    <h1 class="mobile-header-title">
      <a href="/">贰白</a>
    </h1>
    <div class="mobile-header-item"></div>
  </div>
</div>
    <div class="container-inner">
      <main class="main" id="main">
        <div class="main-wrapper">
          
    
  
  <article class="
  post
   is_post 
  ">
    <header class="post-header">
      <div class="post-time syuanpi fadeInUpShort back-1">
        <div class="post-time-wrapper">
          <span>2018-01-22</span>
          
            
              <span class="post-category"><a href="/categories/JVM/">JVM</a></span>
            
          
          
            
              <aside class="post-tags syuanpi fadeInUpShort back-3">
              
                <a href="/tags/JVM/">JVM</a>
              
              </aside>
            
          
        </div>
      </div>
      <h1 class="post-title syuanpi fadeInUpShort back-2">
        
          Mac 编译openJDK9
        
      </h1>
    </header>
    <div class="post-content syuanpi fadeInUpShort back-3">
      
        <ul>
<li>安装mercurial版本管理</li>
</ul>
<p><code>brew install mercurial</code></p>
<a id="more"></a>
<ul>
<li>安装ccache提高编译速度</li>
</ul>
<p><code>brew install ccache</code></p>
<ul>
<li>安装freetype</li>
</ul>
<p><code>brew install freetype</code></p>
<ul>
<li>获取源码</li>
</ul>
<p><code>hg clone http://hg.openjdk.java.net/jdk9/jdk9 YourOpenJDK</code></p>
<p><code>cd YourOpenJDK</code></p>
<p><code>chmod +x get_source.sh</code></p>
<p><code>./get_source.sh</code></p>
<ul>
<li>修改文件属性</li>
</ul>
<p><code>chmod +x configure</code></p>
<ul>
<li>输入一下命令激活后会生成一个编译配置。</li>
</ul>
<p><code>sudo ./configure --enable-debug --with-target-bits=64</code></p>
<ul>
<li>修改<code>get_resource.sh</code>，下载过程中，如果失败，则一直尝试，直至成功</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> Get clones of all absent nested repositories (harmless if already exist)</div><div class="line">sh ./common/bin/hgforest.sh clone "$@" || exit $?</div><div class="line"></div><div class="line"><span class="meta">#</span> Update all existing repositories to the latest sources</div><div class="line">sh ./common/bin/hgforest.sh pull -u</div></pre></td></tr></table></figure>
<p>修改为</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> Get clones of all absent nested repositories (harmless if already exist)</div><div class="line">sh ./common/bin/hgforest.sh clone "$@"</div><div class="line"></div><div class="line">while [ $? -ne 0 ]</div><div class="line">do</div><div class="line">    sh ./common/bin/hgforest.sh clone "$@"</div><div class="line">done</div><div class="line"></div><div class="line"><span class="meta">#</span> Update all existing repositories to the latest sources</div><div class="line">sh ./common/bin/hgforest.sh pull -u</div><div class="line"></div><div class="line">while [ $? -ne 0 ]</div><div class="line">do</div><div class="line">    sh ./common/bin/hgforest.sh pull -u</div><div class="line">done</div></pre></td></tr></table></figure>
<ul>
<li>配置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo ./configure --disable-warnings-as-errors --with-boot-jdk=/Library/Java/JavaVirtualMachines/jdk1.8.0_65.jdk/Contents/Home/</div></pre></td></tr></table></figure>
<p><strong>参数解释</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">--with-target-bits：设置32位/64位编译</div><div class="line"></div><div class="line">--with-freetype：设置freetype路径</div><div class="line"></div><div class="line">--enable-ccache：设置启用ccache</div><div class="line"></div><div class="line">--with-jvm-variants=client,server：为了保证兼容性，编译时JVM的Client和Server都会被编译</div><div class="line"></div><div class="line">--with-boot-jdk-jvmargs：提供运行Bootstrap JDK所需要的JVM参数</div><div class="line"></div><div class="line">--disable-zip-debug-info：禁用zip调试信息</div><div class="line"></div><div class="line">--disable-warnings-as-errors：禁用将警告当做错误，避免因为警告而中断编译</div><div class="line"></div><div class="line">--with-debug-level：设置调试等级</div><div class="line"></div><div class="line">2&gt;&amp;1 | tee configure_mac_x64.log：将错误信息重定向至标准输出，并输出到configure_mac_x64.log</div></pre></td></tr></table></figure>
<p><strong>configure</strong></p>
<p><code>sudo ./configure --enable-debug --with-target-bits=64</code></p>
<p> 如果是正式版本，./configure后边不需要加参数。configure过程会检查一些配置，然后在YourOpenJDK/build目录下会有macosx-x86_64-normal-server-fastdebug目录，如果不是fastdebug版本，会有macosx-x86_64-normal-server-release目录。这个过程中遇到一个问题:</p>
<blockquote>
<p><code>configure: error: GCC compiler is required</code></p>
</blockquote>
<p>对于这个问题，我查到是YourOpenJDK/common/autoconf/generated-configure.sh里边校验抛出，我直接找到下边文本出现的两个地方给注释掉了……</p>
<blockquote>
<p><code>as_fn_error $? &quot;GCC compiler is required. Try setting --with-tools-dir.&quot; &quot;$LINENO&quot; 5</code></p>
</blockquote>
<p><img src="http://ww4.sinaimg.cn/large/0060lm7Tly1fom4mil51aj31kw0yj4bc.jpg" alt="Markdown"></p>
<p><strong>编译</strong></p>
<p><code>sudo make CONF=macosx-x86_64-normal-server-release</code></p>
<p><strong>验证</strong></p>
<p><img src="https://wx2.sinaimg.cn/mw690/8c564d2agy1fpigacx7t9j216606mabz.jpg" alt="Markdown"></p>
<p><strong>问题1</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">=== Output from failing command(s) repeated here ===</div><div class="line">/usr/bin/printf &quot;* For target hotspot_variant-server_libjvm_objs_lcm.o:\n&quot;</div><div class="line">* For target hotspot_variant-server_libjvm_objs_lcm.o:</div><div class="line">(/usr/bin/grep -v -e &quot;^Note: including file:&quot; &lt;  /Users/2bai/Documents/code/jdk9/build/macosx-x86_64-normal-server-fastdebug/make-support/failure-logs/hotspot_variant-server_libjvm_objs_lcm.o.log || true) | /usr/bin/head -n 12</div><div class="line">/Users/2bai/Documents/code/jdk9/hotspot/src/share/vm/opto/lcm.cpp:42:35: error: ordered comparison between pointer and zero (&apos;address&apos; (aka &apos;unsigned char *&apos;) and &apos;int&apos;)</div><div class="line">  if (Universe::narrow_oop_base() &gt; 0) &#123; // Implies UseCompressedOops.</div><div class="line">      ~~~~~~~~~~~~~~~~~~~~~~~~~~~ ^ ~</div><div class="line">1 error generated.</div><div class="line">if test `/usr/bin/wc -l &lt; /Users/2bai/Documents/code/jdk9/build/macosx-x86_64-normal-server-fastdebug/make-support/failure-logs/hotspot_variant-server_libjvm_objs_lcm.o.log` -gt 12; then /bin/echo &quot;   ... (rest of output omitted)&quot; ; fi</div><div class="line">/usr/bin/printf &quot;\n* All command lines available in /Users/2bai/Documents/code/jdk9/build/macosx-x86_64-normal-server-fastdebug/make-support/failure-logs.\n&quot;</div><div class="line"></div><div class="line">* All command lines available in /Users/2bai/Documents/code/jdk9/build/macosx-x86_64-normal-server-fastdebug/make-support/failure-logs.</div><div class="line">/usr/bin/printf &quot;=== End of repeated output ===\n&quot;</div><div class="line">=== End of repeated output ===</div><div class="line">if /usr/bin/grep -q &quot;recipe for target .* failed&quot; /Users/2bai/Documents/code/jdk9/build/macosx-x86_64-normal-server-fastdebug/build.log 2&gt; /dev/null; then /usr/bin/printf &quot;\n=== Make failed targets repeated here ===\n&quot; ; /usr/bin/grep &quot;recipe for target .* failed&quot; /Users/2bai/Documents/code/jdk9/build/macosx-x86_64-normal-server-fastdebug/build.log ; /usr/bin/printf &quot;=== End of repeated output ===\n&quot; ; /usr/bin/printf &quot;\nHint: Try searching the build log for the name of the first failed target.\n&quot; ; else /usr/bin/printf &quot;\nNo indication of failed target found.\n&quot; ; /usr/bin/printf &quot;Hint: Try searching the build log for &apos;] Error&apos;.\n&quot; ; fi</div><div class="line"></div><div class="line">=== Make failed targets repeated here ===</div><div class="line">lib/CompileJvm.gmk:207: recipe for target &apos;/Users/2bai/Documents/code/jdk9/build/macosx-x86_64-normal-server-fastdebug/hotspot/variant-server/libjvm/objs/lcm.o&apos; failed</div><div class="line">make/Main.gmk:263: recipe for target &apos;hotspot-server-libs&apos; failed</div><div class="line">=== End of repeated output ===</div><div class="line"></div><div class="line">Hint: Try searching the build log for the name of the first failed target.</div><div class="line">/usr/bin/printf &quot;Hint: See common/doc/building.html#troubleshooting for assistance.\n\n&quot;</div><div class="line">Hint: See common/doc/building.html#troubleshooting for assistance.</div><div class="line"></div><div class="line">gmake[2]: Leaving directory &apos;/Users/2bai/Documents/code/jdk9&apos;</div><div class="line">make[1]: *** [main] Error 2</div><div class="line">make: *** [all] Error 2</div></pre></td></tr></table></figure>
<p><strong>解决</strong></p>
<p>修改<code>jdk9/hotspot/src/share/vm/opto/lcm.cpp</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (base() &gt; <span class="number">0</span>) &#123; </div><div class="line"><span class="comment">//修改为</span></div><div class="line"><span class="keyword">if</span> (base() != <span class="literal">NULL</span>) &#123;</div></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (Universe::narrow_oop_base() &gt; <span class="number">0</span>) &#123; <span class="comment">// Implies UseCompressedOops.</span></div><div class="line"><span class="comment">//修改为</span></div><div class="line"><span class="keyword">if</span> (Universe::narrow_oop_base() != <span class="literal">NULL</span>) &#123; <span class="comment">// Implies UseCompressedOops.</span></div></pre></td></tr></table></figure>
<p><strong>问题2</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">jdk9/hotspot/src/jdk.hotspot.agent/macosx/native/libsaproc/MacosxDebuggerLocal.m:692:21: warning: &apos;ePtAttachDeprecated&apos; is deprecated: PT_ATTACH is deprecated. See PT_ATTACHEXC [-Wdeprecated-declarations]</div><div class="line">  if ((res = ptrace(PT_ATTACH, pid, 0, 0)) &lt; 0) &#123;</div><div class="line">                    ^</div><div class="line">/usr/include/sys/ptrace.h:85:19: note: expanded from macro &apos;PT_ATTACH&apos;</div><div class="line">#define PT_ATTACH       ePtAttachDeprecated     /* trace some running process */</div><div class="line">                        ^</div><div class="line">/usr/include/sys/ptrace.h:71:22: note: &apos;ePtAttachDeprecated&apos; has been explicitly marked deprecated here</div><div class="line">        ePtAttachDeprecated __deprecated_enum_msg(&quot;PT_ATTACH is deprecated. See PT_ATTACHEXC&quot;) = 10</div><div class="line">                            ^</div></pre></td></tr></table></figure>
<p><strong>解决2</strong></p>
<p>尝试直接把上面报错地方的PT_ATTACH改成10试试</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> ((res = ptrace(PT_ATTACH, pid, <span class="number">0</span>, <span class="number">0</span>)) &lt; <span class="number">0</span>) &#123;</div><div class="line"><span class="comment">//修改为</span></div><div class="line"><span class="keyword">if</span> ((res = ptrace(<span class="number">10</span>, pid, <span class="number">0</span>, <span class="number">0</span>)) &lt; <span class="number">0</span>) &#123;</div></pre></td></tr></table></figure>
<p><strong>问题3</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">jdk9/jdk/src/java.desktop/share/native/libjavajpeg/jdhuff.c:458:13: warning: shifting a negative signed value is undefined [-Wshift-negative-value]</div><div class="line">  &#123; 0, ((-1)&lt;&lt;1) + 1, ((-1)&lt;&lt;2) + 1, ((-1)&lt;&lt;3) + 1, ((-1)&lt;&lt;4) + 1,</div><div class="line">        ~~~~^</div></pre></td></tr></table></figure>
<p><strong>解决3</strong></p>
<p>修改文件：</p>
<ul>
<li>jdk9/jdk/src/java.desktop/share/native/libjavajpeg/jdphuff.c:221</li>
<li>jdk9/jdk/src/java.desktop/share/native/libjavajpeg/jdhuff.c:458</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">static const int extend_offset[16] = /* entry n is (-1 &lt;&lt; n) + 1 */</div><div class="line">  &#123; 0, (-(1&lt;&lt;1)) + 1, (-(1&lt;&lt;2)) + 1, (-(1&lt;&lt;3)) + 1, (-(1&lt;&lt;4)) + 1,</div><div class="line">    (-(1&lt;&lt;5)) + 1, (-(1&lt;&lt;6)) + 1, (-(1&lt;&lt;7)) + 1, (-(1&lt;&lt;8)) + 1,</div><div class="line">    (-(1&lt;&lt;9)) + 1, (-(1&lt;&lt;10)) + 1, (-(1&lt;&lt;11)) + 1, (-(1&lt;&lt;12)) + 1,</div><div class="line">    (-(1&lt;&lt;13)) + 1, (-(1&lt;&lt;14)) + 1, (-(1&lt;&lt;15)) + 1 &#125;;</div></pre></td></tr></table></figure>
<p><strong>问题4</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">=== Output from failing command(s) repeated here ===</div><div class="line">* For target hotspot_variant-server_libjvm_objs_loopPredicate.o:</div><div class="line">../src/share/vm/opto/loopPredicate.cpp:903:73: error: ordered comparison between pointer and zero (&apos;const TypeInt *&apos; and &apos;int&apos;)</div><div class="line">      assert(rng-&gt;Opcode() == Op_LoadRange || _igvn.type(rng)-&gt;is_int() &gt;= 0, &quot;must be&quot;);</div><div class="line">                                              ~~~~~~~~~~~~~~~~~~~~~~~~~ ^  ~</div><div class="line">../src/share/vm/utilities/debug.hpp:141:33: note: expanded from macro &apos;assert&apos;</div><div class="line">#define assert(p, ...) vmassert(p, __VA_ARGS__)</div><div class="line">                                ^</div><div class="line">../src/share/vm/utilities/debug.hpp:130:9: note: expanded from macro &apos;vmassert&apos;</div><div class="line">  if (!(p)) &#123;                                                                  \</div><div class="line">        ^</div><div class="line">1 error generated.</div><div class="line"></div><div class="line">* All command lines available in /Users/2bai/Documents/code/jdk9/build/macosx-x86_64-normal-serverANDclient-slowdebug/make-support/failure-logs.</div><div class="line">=== End of repeated output ===</div></pre></td></tr></table></figure>
<p><strong>解决4</strong></p>
<p>修改<code>jdk9/hotspot/src/share/vm/opto/loopPredicate.cpp:903</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">assert(rng-&gt;Opcode() == Op_LoadRange || _igvn.type(rng)-&gt;is_int() &gt;= 0, &quot;must be&quot;);</div></pre></td></tr></table></figure>
<p>修改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">assert(rng-&gt;Opcode() == Op_LoadRange || _igvn.type(rng)-&gt;is_int()-&gt;_lo &gt;= 0, &quot;must be&quot;);</div></pre></td></tr></table></figure>
<h3 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h3><p><strong>和编译openJDK9无关！！！！</strong></p>
<p>之前编译的时候取消了JAVA_HOME，怕自己忘记，记一下。</p>
<ul>
<li>JAVA_HOME</li>
</ul>
<p><code>/Library/Java/JavaVirtualMachines/jdk1.8.0_65.jdk/Contents/Home</code></p>

      
    
    </div>
    
      
  <div class="post-reward">
    <span class="reward-btn" id="reward-btn">点这里</span>
    <div class="reward-wrapper syuanpi" id="reward-wrapper" style="display:none;">
      
      <div class="reward-item reward-alipay">
        <img src="https://wx3.sinaimg.cn/mw690/8c564d2aly1ftkt83thjlj20o60skjzn.jpg">
      </div>
      
    </div>
  </div>


      
    
  </article>
  
    
  <nav class="article-page">
    
      <a href="/JVM/memory.html" id="art-left" class="art-left">
        <span class="next-title">
          <i class="iconfont icon-left"></i>Java内存区域
        </span>
      </a>
    
    
      <a href="/Spring/validation.html" id="art-right" class="art-right">
        <span class="prev-title"> 
          Spring Boot验证<i class="iconfont icon-right"></i>  
        </span>
      </a>
    
  </nav>

    
  <i id="com-switch" class="iconfont icon-more jumping-in long infinite" style="font-size:24px;display:block;text-align:center;transform:rotate(180deg);"></i>
  <div class="post-comments" id="post-comments" style="display: block;margin: auto 16px;">
    
<!-- Gitment Comments -->
<div id="gitment"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
var gitment = new Gitment({
  owner: "super2bai",
  repo: 'comment',
  oauth: {
    client_id: '37f2293730b41dcb5276',
    client_secret: 'dbab4955840d4cbc88f1563be04ab676662194e5',
  },
})
gitment.render('gitment')
</script>

    
    

  </div>


  
  
    
  
  <aside class="post-toc">
    <span class="title" id="toc-switch"><span>文章导航</span></span>
    <div class="toc-inner syuanpi back-1" style="display:none;">
      <li class="title-link"><a href="javascript:;" class="toTop">Mac 编译openJDK9</a></li>
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#备份"><span class="toc-text">备份</span></a></li></ol>
    </div>
  </aside>



  


        </div>
      </main>

      <footer class="footer syuanpi fadeIn" id="footer">
  <hr>
  <div class="footer-wrapper">
    <div class="left">
      <div class="contact-icon">
    
    
    
    
    
    
    
    
        
            <a href="https://github.com/super2bai" class="iconfont icon-github" title="github"></a>
        
        
        
        
        
        
        
    
</div>
    </div>
    <div class="right">
      <div class="copyright">
    <div class="info">
        <span>&copy;</span>
        <span>2017 ~ 2019</span>
        <span>❤</span>
        <span>super2bai</span>
    </div>
    <div class="theme">
        <span>
            动力来源于
            <a href="http://hexo.io/" target="_blank">Hexo </a>
        </span>
        <span>
            主题
            <a href="https://github.com/ColMugX/hexo-theme-Nlvi"> Nlvi </a>
        </span>
    </div>
    
    <div class="visit_count">
        <i class="iconfont icon-visit"></i>
        <span id="busuanzi_value_site_uv"></span>
        <i class="iconfont icon-people"></i>
        <span id="busuanzi_value_site_pv"></span>
    </div>
    
</div>

    </div>
  </div>
</footer>
    </div>
  </div>
  <script src="/script/lib/jquery/jquery-3.2.1.min.js"></script>


  <script src="/script/lib/lightbox/js/lightbox.min.js"></script>








<script src="/script/src/nlvi.js"></script>

  <script src="/script/scheme/banderole.js"></script>

<script src="/script/bootstarp.js"></script>


<div class="backtop syuanpi melt toTop" id="backtop">
    <i class="iconfont icon-up"></i>
    <span style="text-align:center;font-family:Georgia;"><span style="font-family:Georgia;" id="scrollpercent">1</span>%</span>
</div>


  <div class="search" id="search">
    <div class="mask" id="mask"></div>
    <div class="search-wrapper syuanpi">
      <h2 id="search-header" class="syuanpi">找啥？</h2>
      <div class="input">
        <input type="text" id="local-search-input" results="0" name="">
      </div>
      <div id="local-search-result"></div>
    </div>
  </div>


</body>
</html>
