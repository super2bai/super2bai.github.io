<!DOCTYPE html>
<html lang="">
<head>
    <title> Spring Web MVC · super2bai </title>
    <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="browsermode" content="application">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="super2bai">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="msapplication-navbutton-color" content="#666666">
<meta name= "format-detection" content="telephone=no" />
<meta name="keywords" content="nlvi, Nlvi" />





    <meta name="keywords" content="Spring, Nlvi" />

<link rel="stylesheet" href="/style/style.css">
<script src="/script/jquery.min.js"></script>
<script>
    var CONFIG = {
        title: "super2bai",
        author: "super2bai",
        lightbox: true,
        animate: true
    }
</script>



    <link rel="stylesheet" href="/lightbox/css/lightbox.min.css">




    <link rel="stylesheet" href="/syuanpi/syuanpi.min.css">









    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


</head>
<body>
    <div class="progress">
    <div class="progress-inner"></div>
</div>
    <div class="body">
    <div class="tagcloud-mask"></div>  
<div class="tagcloud" id="tagcloud">
    <div class="tagcloud-inner">
        <a href="/tags/Dubbo/" style="font-size: 14px;">Dubbo</a> <a href="/tags/GitHub-Pages/" style="font-size: 14px;">GitHub Pages</a> <a href="/tags/IO/" style="font-size: 14px;">IO</a> <a href="/tags/Spring/" style="font-size: 14px;">Spring</a> <a href="/tags/Spring-Spring-Boot/" style="font-size: 14px;">Spring Spring-Boot</a> <a href="/tags/Zookeeper/" style="font-size: 14px;">Zookeeper</a> <a href="/tags/分布式/" style="font-size: 14px;">分布式</a>
    </div>
</div>
    <header class="header" id="header">
    <div class="title syuanpi tvIn">
    <div class="table">
        <div class="connect">
            <div class="connect-inner">
                <span><a href="/">super2bai</a></span>
                
            </div>
        </div>
    </div>
</div>
    <nav class="main-nav syuanpi tvIn">
<div class="table">

    <ul class="menu">
        
        
        
            <li class="menu-item">
                <a href="/">
                    <span>Article</span>
                    
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/archives">
                    <span>Archives</span>
                    
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="javascript:;" id="tags">
                    <span>Tags</span>
                    
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/about">
                    <span>About</span>
                    
                    
                </a>
            </li>
        
        
    </ul>

</div>
</nav>
</header>
<div class="mobile-header">
    <div class="mobile-header-body">
        <div class="mobile-header-list">
            
            
                <div class="mobile-nav-item">
                    <a href="/">
                        <span>Article</span>
                        
                        
                    </a>
                </div>
            
            
            
                <div class="mobile-nav-item">
                    <a href="/archives">
                        <span>Archives</span>
                        
                        
                    </a>
                </div>
            
            
            
                <div class="mobile-nav-item inner-cloud">
                    <div class="mobile-nav-tag">
                        <a href="javascript:;" id="mobile-tags">
                            <span>Tags</span>
                            
                            
                        </a>
                    </div>
                    <div class="mobile-nav-tagcloud">
                        <div class="mobile-tagcloud-inner">
                            <a href="/tags/Dubbo/" style="font-size: 14px;">Dubbo</a> <a href="/tags/GitHub-Pages/" style="font-size: 14px;">GitHub Pages</a> <a href="/tags/IO/" style="font-size: 14px;">IO</a> <a href="/tags/Spring/" style="font-size: 14px;">Spring</a> <a href="/tags/Spring-Spring-Boot/" style="font-size: 14px;">Spring Spring-Boot</a> <a href="/tags/Zookeeper/" style="font-size: 14px;">Zookeeper</a> <a href="/tags/分布式/" style="font-size: 14px;">分布式</a>
                        </div>
                    </div>
                </div>
            
            
            
                <div class="mobile-nav-item">
                    <a href="/about">
                        <span>About</span>
                        
                        
                    </a>
                </div>
            
            
        </div>
    </div>
    <div class="mobile-header-nav">
        <div class="mobile-header-item" id="mobile-left">
            <div class="header-menu-item">
                <span class="header-menu-line"></span>
            </div>
        </div>
        <h1 class="mobile-header-title">
            <a href="/">super2bai</a>
        </h1>
        <div class="mobile-header-item"></div>
    </div>
</div>

    <div class="container">
        <main class="main" id="main">
            
    
    <article class="post">
        <header class="post-header">
            <div class="post-time syuanpi riseIn-light back-1">
                <span>November 29, 2017</span>
                
            </div>
            <h1 class="post-title syuanpi riseIn-light back-2">
            
                Spring Web MVC
            
            </h1>
            
                
                    <div class="post-tags syuanpi riseIn-light back-3">
                    
                        <a href="/tags/Spring/">Spring</a>
                    
                    </div>
                
            
        </header>
        <div class="post-content syuanpi riseIn-light back-3">
            
                <h3 id="Spring-Web-MVC"><a href="#Spring-Web-MVC" class="headerlink" title="Spring Web MVC"></a>Spring Web MVC</h3><a id="more"></a>
<p>M : Model</p>
<p>V  : View</p>
<p>C  : Controller -&gt; DispatcherServlet</p>
<p>Front Controller =  DispatcherServlet</p>
<p>Application Controller = <code>@Controller</code> or  <code>xx implements Controller</code></p>
<ul>
<li>Context<ul>
<li>ServletContextListener -&gt; ContextLoaderListener -&gt; Root WebApplicationContext</li>
<li>DispatcherServlet -&gt; Servlet WebApplicationContext</li>
</ul>
</li>
<li>Services<ul>
<li>@Services</li>
</ul>
</li>
<li>Repositories<ul>
<li>@Repositories</li>
</ul>
</li>
</ul>
<h3 id="映射处理"><a href="#映射处理" class="headerlink" title="映射处理"></a>映射处理</h3><ul>
<li>Servlet匹配规则<ul>
<li>精确匹配<ul>
<li><code>/IndexServlet</code></li>
</ul>
</li>
<li>模糊匹配<ul>
<li><code>/*.jsp</code></li>
<li>当前目录下的所有目录</li>
</ul>
</li>
<li>/匹配<ul>
<li><code>/</code></li>
<li>当前目录</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>Servlet请求映射<ul>
<li>Servlet URL Pattern</li>
<li>Filter URL Pattern</li>
</ul>
</li>
<li>Spring Web MVC<ul>
<li>DispatcherServlet</li>
<li>HandlerMapping</li>
</ul>
</li>
</ul>
<h4 id="RestController-Controller-ResponseBody"><a href="#RestController-Controller-ResponseBody" class="headerlink" title="@RestController=@Controller+@ResponseBody"></a><code>@RestController</code>=<code>@Controller</code>+<code>@ResponseBody</code></h4><p><code>org.springframework.web.bind.annotation.RestController</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.springframework.web.bind.annotation;</div><div class="line"><span class="comment">//ignore</span></div><div class="line"><span class="meta">@Target</span>(ElementType.TYPE)</div><div class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</div><div class="line"><span class="meta">@Documented</span></div><div class="line"><span class="comment">//关键点</span></div><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RestController &#123;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * The value may indicate a suggestion for a logical component name,</span></div><div class="line"><span class="comment">	 * to be turned into a Spring bean in case of an autodetected component.</span></div><div class="line"><span class="comment">	 * <span class="doctag">@return</span> the suggested component name, if any (or empty String otherwise)</span></div><div class="line"><span class="comment">	 * <span class="doctag">@since</span> 4.0.1</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="meta">@AliasFor</span>(annotation = Controller.class)</div><div class="line">	<span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>DispatcherServlet &lt; FrameworkServlet &lt; HttpServletBean &lt; HttpServlet</p>
<ul>
<li>新建项目，依赖Web</li>
<li>新建packet-&gt;controller -&gt; 新建Controller -&gt; RestDemoController</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.bai.springwebmvc.controller;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Rest Demo Controller</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@RestController</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestDemoController</span> </span>&#123;</div><div class="line">    <span class="meta">@GetMapping</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"Hello World"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>浏览器访问:localhost:8080,页面显示“Hello World”。</p>
<h4 id="问题及回答"><a href="#问题及回答" class="headerlink" title="问题及回答"></a>问题及回答</h4><p>Q ： 为什么Controller没有映射地址却能启动起来</p>
<p>A ： 自动装配，详情参见下面源码：<code>org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration</code>。此处的ServletContext path =”” or “/“，此二者等价。</p>
<p>Request URL = ServletContext path + @RequestMapping(“”) 或者 @GetMapping()</p>
<p>当前例子中，Request URL = “”+“”=“” -&gt; RestDemoController#index</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.springframework.boot.autoconfigure.web.servlet;</div><div class="line"></div><div class="line"><span class="comment">// ignore import</span></div><div class="line"></div><div class="line"><span class="meta">@AutoConfigureOrder</span>(-<span class="number">2147483648</span>)</div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@ConditionalOnWebApplication</span>(</div><div class="line">    type = Type.SERVLET</div><div class="line">)</div><div class="line"><span class="meta">@ConditionalOnClass</span>(&#123;DispatcherServlet.class&#125;)</div><div class="line"><span class="meta">@AutoConfigureAfter</span>(&#123;ServletWebServerFactoryAutoConfiguration.class&#125;)</div><div class="line"><span class="meta">@EnableConfigurationProperties</span>(&#123;ServerProperties.class&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DispatcherServletAutoConfiguration</span> </span>&#123;</div><div class="line">  </div><div class="line">	<span class="comment">/*</span></div><div class="line"><span class="comment">	 * The bean name for a DispatcherServlet that will be mapped to the root URL "/"</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_DISPATCHER_SERVLET_BEAN_NAME = <span class="string">"dispatcherServlet"</span>;</div><div class="line"></div><div class="line">	<span class="comment">/*</span></div><div class="line"><span class="comment">	 * The bean name for a ServletRegistrationBean for the DispatcherServlet "/"</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_DISPATCHER_SERVLET_REGISTRATION_BEAN_NAME = <span class="string">"dispatcherServletRegistration"</span>;</div><div class="line"></div><div class="line">	<span class="meta">@Configuration</span></div><div class="line">	<span class="meta">@Conditional</span>(DefaultDispatcherServletCondition.class)</div><div class="line">	<span class="meta">@ConditionalOnClass</span>(ServletRegistration.class)</div><div class="line">    <span class="comment">//关键点</span></div><div class="line">	<span class="meta">@EnableConfigurationProperties</span>(WebMvcProperties.class)</div><div class="line">	<span class="keyword">protected</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DispatcherServletConfiguration</span> </span>&#123;</div><div class="line">      <span class="comment">//ignore</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Q : 为什么访问localhost:8080可以调用到RestDemoController#index？</p>
<p>A : Spring MVC的处理方式是HandlerMapping自动寻找Request URL，匹配的Handler，Handler是处理的方法，当前这是一种实例。Request -&gt; Handler -&gt; 执行结果 -&gt; 返回(Rest) -&gt; 普通的文本。</p>
<p>HandlerMapping -&gt; RequestMappingHandlerMapping -&gt; @RequestMapping + Handler Mapping </p>
<h4 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h4><hr>
<p>Spring Web MVC 的配置 Bean ：<code>org.springframework.boot.autoconfigure.web.servlet.WebMvcProperties</code></p>
<p>Spring Boot允许通过application.properties去定义配置，配置外部化。</p>
<p><code>WebMvcProperties</code>配置前缀：<code>spring.mvc</code></p>
<hr>
<p><code>@PostMapping</code>     Post请求    @RequestMapping(method = RequestMethod.POST)      Create(C)</p>
<p><code>@GetMapping</code>       Get请求      @RequestMapping(method = RequestMethod.GET)        Read(R)</p>
<p><code>@PutMapping</code>       Put请求      @RequestMapping(method = RequestMethod.PUT)        Update(R)</p>
<p><code>@DeleteMapping</code> Delete请求 @RequestMapping(method = RequestMethod.DELETE) Delete(D)</p>
<p>无HeadMapping</p>
<hr>
<p>拦截器：HandlerInterceptor ，可以理解handler到底是什么</p>
<p><strong>如何装配</strong></p>
<p>在启动类(xxxApplication,@SpringBootApplication) 继承WebMvcConfigurerAdapter(此类已经逐渐被淘汰)，重写addInterceptors方法，通过registry.addInterceptor方法将自定义拦截器装配。</p>
<p><strong>处理顺序</strong></p>
<p>preHandle(true) -&gt; HandlerMethod(因为采用了@GetMapping，其它场景可能会有不同)执行(Method#invoke) -&gt; postHandle -&gt; afterCompletion</p>
<h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a><a href="https://docs.spring.io/spring/docs/5.0.2.RELEASE/spring-framework-reference/web.html#mvc-exceptionhandlers" target="_blank" rel="external">异常处理</a></h3><ul>
<li>Servlet标准</li>
<li>Spring Web MVC</li>
<li>Spring Boot</li>
</ul>
<h4 id="理解web-xml错误页面"><a href="#理解web-xml错误页面" class="headerlink" title="理解web.xml错误页面"></a>理解web.xml错误页面</h4><h5 id="传统的Servlet-web-xml错误页面"><a href="#传统的Servlet-web-xml错误页面" class="headerlink" title="传统的Servlet web.xml错误页面"></a>传统的Servlet web.xml错误页面</h5><p>Servlet -&gt; web.xml(schema -&gt; .xsd) -&gt; 错误页面</p>
<p><error-page>处理逻辑：</error-page></p>
<ul>
<li>处理状态码<error-code></error-code></li>
<li>处理异常类型<exception-type></exception-type></li>
<li>处理服务<location></location></li>
<li>优点<ul>
<li>统一处理，业界标准</li>
</ul>
</li>
<li>不足<ul>
<li>灵活度不够，只能定义在web.xml文件或annotation里面</li>
</ul>
</li>
</ul>
<h5 id="Spring-Web-MVC-异常处理"><a href="#Spring-Web-MVC-异常处理" class="headerlink" title="Spring Web MVC 异常处理"></a>Spring Web MVC 异常处理</h5><ul>
<li>@ExceptionHandler</li>
</ul>
<ul>
<li>@RestControllerAdvice=@ControllerAdvice+@ResponseBody</li>
<li>@ControllerAdvice专门拦截@Controller</li>
</ul>
<ul>
<li>不足<ul>
<li><a href="https://docs.spring.io/spring/docs/5.0.2.RELEASE/spring-framework-reference/web.html#mvc-exceptionhandlers" target="_blank" rel="external">很难完全掌握所有的异常类型</a></li>
</ul>
</li>
<li>优点<ul>
<li>易于理解，尤其是全局异常处理</li>
</ul>
</li>
</ul>
<h5 id="Spring-Boot错误处理页面"><a href="#Spring-Boot错误处理页面" class="headerlink" title="Spring Boot错误处理页面"></a>Spring Boot错误处理页面</h5><ul>
<li>实现<code>ErrorPageRegistrar</code>接口</li>
</ul>
<ul>
<li>注册ErrorPage对象</li>
<li>实现ErrorPage对象中的Path路径Web服务</li>
</ul>
<ul>
<li>不足<ul>
<li>页面处理的路径必须笃定</li>
</ul>
</li>
<li>优点<ul>
<li>状态码<ul>
<li>比较通用，不需要理解SpringWebMVC异常体系</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.bai.springwebmvc;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.bai.springwebmvc.interceptor.DefaultHandlerInterceptor;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.web.server.ErrorPage;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.web.server.ErrorPageRegistrar;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.web.server.ErrorPageRegistry;</div><div class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</div><div class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</div><div class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</div><div class="line"></div><div class="line"><span class="meta">@SpringBootApplication</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringWebmvcApplication</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> <span class="keyword">implements</span> <span class="title">ErrorPageRegistrar</span></span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		SpringApplication.run(SpringWebmvcApplication.class, args);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerErrorPages</span><span class="params">(ErrorPageRegistry registry)</span> </span>&#123;</div><div class="line">		registry.addErrorPages(<span class="keyword">new</span> ErrorPage(HttpStatus.NOT_FOUND,<span class="string">"/404.html"</span>));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="视图技术"><a href="#视图技术" class="headerlink" title="视图技术"></a>视图技术</h3><ul>
<li>View</li>
</ul>
<ul>
<li>ViewResolver<ul>
<li>ContentNegotiatingViewResolver</li>
</ul>
</li>
<li>实战<ul>
<li>Thymeleaf</li>
</ul>
</li>
</ul>
<hr>
<h4 id="View"><a href="#View" class="headerlink" title="View"></a>View</h4><p><code>org.springframework.web.servlet.View#render</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">render</span><span class="params">(@Nullable Map&lt;String, ?&gt; model,</span></span></div><div class="line"><span class="function"><span class="params">			HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception</span>;</div></pre></td></tr></table></figure>
<ul>
<li>处理页面渲染的逻辑<ul>
<li>Velocity</li>
<li>JSP</li>
<li>Thymeleaf</li>
</ul>
</li>
</ul>
<h4 id="ViewResolver"><a href="#ViewResolver" class="headerlink" title="ViewResolver"></a>ViewResolver</h4><p>页面+解析器(resolve)</p>
<p><code>org.springframework.web.servlet.ViewResolver#resolveViewName</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * viewName : view的名称</span></div><div class="line"><span class="comment"> * locale   : 多语言(国际化)</span></div><div class="line"><span class="comment"> * 寻找对应的View对象</span></div><div class="line"><span class="comment"> * requestURI -&gt; RequestMappingHandlerMaping -&gt; HanleMethod -&gt;</span></div><div class="line"><span class="comment"> * return "viewName" -&gt; ViewResolver -&gt; View -&gt; render -&gt; HTML</span></div><div class="line"><span class="comment"> * 完整的页面名称 = prefix + "viewName" + suffix</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@Nullable</span></div><div class="line">	<span class="function">View <span class="title">resolveViewName</span><span class="params">(String viewName, Locale locale)</span> <span class="keyword">throws</span> Exception</span>;</div></pre></td></tr></table></figure>
<p>prefix 和 suffix 在<code>org.springframework.boot.autoconfigure.web.servlet.WebMvcProperties.View的属性内</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">View</span> </span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Spring MVC view prefix.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <span class="keyword">private</span> String prefix;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Spring MVC view suffix.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <span class="keyword">private</span> String suffix;</div><div class="line">  <span class="comment">//ignore</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Spring-Boot接续完整的页面路径"><a href="#Spring-Boot接续完整的页面路径" class="headerlink" title="Spring Boot接续完整的页面路径"></a>Spring Boot接续完整的页面路径</h5><p>spring.view.prefix + hanlerMethod return + spring.view.suffix</p>
<p><strong>自动装配类</strong>：<code>org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration</code></p>
<p>进行自动装配，html不需要在web.xml里配置</p>
<p><strong>配置项类</strong>：<code>org.springframework.boot.autoconfigure.thymeleaf.ThymeleafProperties</code></p>
<p>配置项前缀：<code>spring.thymeleaf</code></p>
<p>模板寻找前缀：<code>spring.thymeleaf.prefix</code></p>
<p>模板寻找后缀：<code>spring.thymeleaf.suffix</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.springframework.boot.autoconfigure.thymeleaf;</div><div class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.thymeleaf"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThymeleafProperties</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_ENCODING = Charset.forName(<span class="string">"UTF-8"</span>);</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PREFIX = <span class="string">"classpath:/templates/"</span>;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SUFFIX = <span class="string">".html"</span>;</div><div class="line">  <span class="comment">//ignore</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ContentNegotiatingViewResolver"><a href="#ContentNegotiatingViewResolver" class="headerlink" title="ContentNegotiatingViewResolver"></a>ContentNegotiatingViewResolver</h4><p><code>org.springframework.web.servlet.view.ContentNegotiatingViewResolver</code></p>
<ul>
<li>用于处理多个ViewResolver<ul>
<li>JSP</li>
<li>Velocity</li>
<li>Thymeleaf</li>
</ul>
</li>
</ul>
<ul>
<li>当所有的ViewResover配置完成时，它们的order默认值时一样的，所以先来先服务(List)</li>
<li>当它们定义自己的order，通过order来倒序排列<ul>
<li>ViewResolver有优先级,排序在#getCandidateViews内</li>
</ul>
</li>
</ul>
<ul>
<li>流程<ul>
<li>得到CandidateViews(List)</li>
<li>得到最匹配的View</li>
<li>render</li>
</ul>
</li>
</ul>
<h4 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h4><ul>
<li>添加maven依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--Thymeleaf--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>修改默认配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--resources/application.properties--&gt;</span></div><div class="line">spring.thymeleaf.prefix = classpath:/thymeleaf/</div><div class="line">spring.thymeleaf.suffix = .htm</div></pre></td></tr></table></figure>
<ul>
<li>添加页面<ul>
<li>resources下添加directory:<code>thymeleaf</code></li>
<li>在<code>thymeleaf</code>下添加file：<code>index.htm</code></li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--/*@thymesVar id="name" type="java.lang.String"*/--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">"#&#123;home.welcome&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>添加controller</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.bai.springwebmvc.controller;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</div><div class="line"></div><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">indexController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>浏览器访问localhost:8080，页面显示<code>??home.welcome_zh_CN??</code></li>
</ul>
<h3 id="国际化-i18N"><a href="#国际化-i18N" class="headerlink" title="国际化(i18N)"></a>国际化(i18N)</h3><ul>
<li>Locale/LocaleContext</li>
<li>LocaleContextHolder<ul>
<li>Spring内的对象</li>
<li>缓存context</li>
</ul>
</li>
<li>LocaleResolver/LocaleContextResolver</li>
</ul>
<p><code>org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolver</code></p>
<h4 id="代码示例-1"><a href="#代码示例-1" class="headerlink" title="代码示例"></a>代码示例</h4><ul>
<li>修改application.properties</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">spring.messages.basename=META-INF/locale/messages</div></pre></td></tr></table></figure>
<ul>
<li>在上面的文件夹下添加文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#文件路径META-INF/locale/messages/messages.properties</div><div class="line">home.welcome = welcome</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#文件路径META-INF/locale/messages/messages_zh_cn.properties</div><div class="line">home.welcome = 欢迎</div></pre></td></tr></table></figure>
<ul>
<li>访问localhost:8080,页面会根据浏览器的设置返回对应语言的文字</li>
</ul>
<h3 id="问题及回答-1"><a href="#问题及回答-1" class="headerlink" title="问题及回答"></a>问题及回答</h3><p>Q：遇到新问题如何查文档</p>
<p>A：在能定位错误范围的前提下，尽量不Google，找规范文档。解决问题后，读相关资料，不要为了解决问题而解决，而是要尽量扩充知识面，积累知识。</p>
<p>Q：怎么处理异常比较优雅</p>
<p>A：采用ExceptionHandler，代码层面易于理解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.bai.springwebmvc.controller;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</div><div class="line"><span class="keyword">import</span> org.springframework.web.servlet.NoHandlerFoundException;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</div><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"></div><div class="line"><span class="meta">@RestControllerAdvice</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestControllerAdvicer</span> </span>&#123;</div><div class="line">	<span class="comment">//多个Exception中间用","分隔</span></div><div class="line">    <span class="meta">@ExceptionHandler</span>(&#123;NoHandlerFoundException.class,IllegalAccessException.class&#125;)</div><div class="line">    <span class="function"><span class="keyword">public</span>  Object <span class="title">pageNotFound</span><span class="params">(HttpStatus status,HttpServletRequest request, Throwable throwable)</span></span>&#123;</div><div class="line">        Map&lt;String,Object&gt; errors =<span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">        errors.put(<span class="string">"statusCode"</span>,request.getAttribute(<span class="string">"javax.servlet.error.status_code"</span>));</div><div class="line">        errors.put(<span class="string">"requestUri"</span>,request.getAttribute(<span class="string">"javax.servlet.error.request_uri"</span>));</div><div class="line">        <span class="keyword">return</span> errors;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@ExceptionHandler</span>(NullPointerException.class)</div><div class="line">    <span class="function"><span class="keyword">public</span>  Object <span class="title">handleNPE</span><span class="params">( Throwable throwable)</span></span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> throwable.getMessage();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>

            
        
        </div>
        
            
            
        
    </article>
    
        
    <nav class="article-page">
        
            <a href="/2017/12/01/Spring-Boot初体验/" id="art-left" class="art-right">
                <span class="next-title">
                    Spring Boot初体验<i class="iconfont icon-right"></i> 
                </span>
            </a>
        
        
            <a href="/2017/11/27/Spring-REST/" id="art-right" class="art-left">
                <span class="prev-title"> 
                    <i class="iconfont icon-left"></i>Spring REST
                </span>
            </a>
        
    </nav>

        
    


        </main>
        <footer class="footer syuanpi fadeIn" id="footer">
    <hr>
    <div class="footer-wrapper">
        <div class="left">
            <div class="contact-icon">
    
    
    
    
    
    
    
    
        
            <a href="https://github.com/super2bai" class="iconfont icon-github" title="github"></a>
        
        
        
        
        
        
        
    
</div>
        </div>
        <div class="right">
            <div class="copyright">
    <div class="info">
        <span>&copy;</span>
        <span>2017 ~ 2017</span>
        <span>❤</span>
        <span>super2bai</span>
    </div>
    <div class="theme">
        <span>
            Powered by
            <a href="http://hexo.io/" target="_blank">Hexo </a>
        </span>
        <span>
            Theme
            <a href="https://github.com/ColMugX/hexo-theme-Nlvi"> Nlvi </a>
        </span>
    </div>
    
    <div class="visit_count">
        <i class="iconfont icon-visit"></i>
        <span id="busuanzi_value_site_uv"></span>
        <i class="iconfont icon-people"></i>
        <span id="busuanzi_value_site_pv"></span>
    </div>
    
</div>
        </div>
    </div>
</footer>
    </div>
    <script src="/script/nlvi.js"></script>
<script src="/script/search.js"></script>

    <script src="/lightbox/js/lightbox.min.js"></script>

<script>
$(document).ready(function(){
    document.body.addEventListener('touchstart', function () {});
    $('.progress').hide();
    $('.body').show();
    Nlvi.tagcloud();
    Nlvi.mobileHeader();
    Nlvi.back2top();
    Nlvi.smoothScroll();
    Nlvi.onView();
    Nlvi.showToc();
    Nlvi.showComments();
    Nlvi.showReward();
    Nlvi.picPos();

    !CONFIG.animate && Nlvi.offAnimate();
    CONFIG.lightbox && Nlvi.onPicBox();
})
</script>
    </div>
    
        
    <div class="post-toc">
        <span class="title">文章目录</span>
        <div class="toc-inner syuanpi back-1 fallIn-light">
            <li class="title-link"><a href="javascript:;" class="toTop">Spring Web MVC</a></li>
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Web-MVC"><span class="toc-text">Spring Web MVC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#映射处理"><span class="toc-text">映射处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RestController-Controller-ResponseBody"><span class="toc-text">@RestController=@Controller+@ResponseBody</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#问题及回答"><span class="toc-text">问题及回答</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#补充"><span class="toc-text">补充</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#异常处理"><span class="toc-text">异常处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#理解web-xml错误页面"><span class="toc-text">理解web.xml错误页面</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#传统的Servlet-web-xml错误页面"><span class="toc-text">传统的Servlet web.xml错误页面</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Spring-Web-MVC-异常处理"><span class="toc-text">Spring Web MVC 异常处理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Spring-Boot错误处理页面"><span class="toc-text">Spring Boot错误处理页面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#视图技术"><span class="toc-text">视图技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#View"><span class="toc-text">View</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ViewResolver"><span class="toc-text">ViewResolver</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Spring-Boot接续完整的页面路径"><span class="toc-text">Spring Boot接续完整的页面路径</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ContentNegotiatingViewResolver"><span class="toc-text">ContentNegotiatingViewResolver</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码示例"><span class="toc-text">代码示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#国际化-i18N"><span class="toc-text">国际化(i18N)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#代码示例-1"><span class="toc-text">代码示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题及回答-1"><span class="toc-text">问题及回答</span></a></li></ol>
        </div>
    </div>

    
    <div class="backtop syuanpi dead toTop" id="backtop">
    <i class="iconfont icon-up"></i>
    <span style="text-align:center;font-family:Georgia;"><span style="font-family:Georgia;" id="scrollpercent">1</span>%</span>
</div>
    
</body>
</html>
